<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Input Promo - QHub</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root {
      --color-bg: #f0f4f8;
      --color-text: #1e293b;
      --color-form: #ffffff;
      --color-accent: #0f766e;
      --color-border: #cbd5e1;
      --color-btn: #ffffff;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--color-bg);
      color: var(--color-text);
      margin: 0;
      padding: 30px 15px;
      transition: background 0.3s, color 0.3s;
    }

    body.dark-mode {
      --color-bg: #0f172a;
      --color-text: #f1f5f9;
      --color-form: #1e293b;
      --color-accent: #2dd4bf;
      --color-border: #334155;
      --color-btn: #000000;
    }

    .nav-bar-custom {
      position: sticky;
      bottom: 0;
      z-index: 999;
      max-width: 450px;
      margin: 0 auto 1.5rem;
      background-color: rgba(167, 209, 205, 0.6);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: 0.75rem 1rem;
      border-radius: 12px;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
    }

    body.dark-mode .nav-bar-custom {
      background-color: rgba(30, 41, 59, 0.6);
    }

    .btn-nav, .toggle-mode {
      background-color: var(--color-accent);
      border: none;
      color: var(--color-btn);
      font-size: 14px;
      font-weight: bold;
      padding: 8px 14px;
      border-radius: 12px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      text-decoration: none;
    }

    .btn-nav:hover, .toggle-mode:hover {
      background-color: #14b8a6;
    }

    .form-container {
      max-width: 420px;
      margin: auto;
      background: var(--color-form);
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }

    h1 {
      color: #1e877c;
      text-align: center;
      margin-bottom: 20px;
    }

    h2 {
      text-align: center;
      color: var(--color-accent);
      margin-bottom: 20px;
    }

    form input,
    form select,
    form textarea {
      width: 100%;
      margin-bottom: 15px;
      height: 45px;
      padding: 10px 14px;
      box-sizing: border-box;
      border: none;
      border-radius: 12px;
      background: var(--color-bg);
      color: var(--color-text);
      font-size: 16px;
      outline: none;
    }

    form input::placeholder,
    form textarea::placeholder {
      color: #94a3b8;
    }

    form button,
    .btn {
      display: block;
      width: 100%;
      box-sizing: border-box;
      padding: 8px;
      font-weight: bold;
      text-align: center;
      background: var(--color-accent);
      color: var(--color-btn);
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s;
      margin-top: 12px;
      text-decoration: none;
    }

    .btn:hover {
      background: #0d9488;
    }

    #notaBox {
      background: var(--color-form);
      max-width: 320px;
      padding: 20px;
      border-radius: 12px;
      margin: 30px auto 10px;
      border: 1px dashed var(--color-border);
      font-family: 'Courier New', monospace;
      color: var(--color-text);
    }

    .toast {
      position: fixed;
      top: 5%;
      left: 50%;
      transform: translateX(-50%);
      z-index: 9999;
      padding: 12px 18px;
      border-radius: 8px;
      font-weight: 500;
      background-color: #22c55e;
      color: white;
      display: none;
      animation: slideInDown 0.5s ease forwards;
    }

    @keyframes slideInDown {
      0% {
        transform: translate(-50%, -100%);
        opacity: 0;
      }
      100% {
        transform: translate(-50%, 0);
        opacity: 1;
      }
    }

    @keyframes fadeOut {
      to { opacity: 0; }
    }

    /* #toggleSidebar {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 1001;
      padding: 10px 20px;
      background: #333;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    } */

    .sidebar {
      position: fixed;
      top: 0;
      right: 0;
      width: 200px;
      height: 100%;
      background: var(--color-form);
      box-shadow: -2px 0 5px rgba(0, 0, 0, 0.2);
      z-index: 1002;
      padding: 20px;
      transition: transform 0.3s ease;
    }

    .hidden {
      display: none;
    }

    .sidebar-content button {
      margin-bottom: 10px;
      width: 100%;
      padding: 10px;
      background: var(--color-accent);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }

    #closeSidebar {
      position: absolute;
      top: 10px;
      right: 10px;
      background: transparent;
      border: none;
      font-size: 24px;
      cursor: pointer;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.3);
      z-index: 1000;
    }

    /* Container biar rapi */
    .promo-toggle {
      margin: 1rem 0;
      display: flex;
      align-items: center;
    }

    /* Switch wrapper */
    .switch {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      font-family: system-ui, sans-serif;
      font-size: 16px;
      font-weight: 500;
      color: var(--color-text);
    }

    /* Hide bawaan checkbox */
    .switch input {
      display: none;
    }

    /* Slider background */
    .slider {
      position: relative;
      width: 50px;
      height: 26px;
      background-color: var(--color-border);
      border-radius: 50px;
      transition: 0.3s;
    }

    /* Bulatan dalam toggle */
    .slider::before {
      content: "";
      position: absolute;
      top: 3px;
      left: 3px;
      width: 20px;
      height: 20px;
      background: var(--color-btn);
      border-radius: 50%;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      transition: 0.3s;
    }

    /* Saat checkbox dicentang */
    .switch input:checked + .slider {
      background-color: var(--color-accent);
    }

    .switch input:checked + .slider::before {
      transform: translateX(24px);
    }

    /* Text label */
    .label-text {
      user-select: none;
    }
  </style>
</head>
<body>
  <h1>Tambah Promo Produk</h1>
  <form id="promoForm" class="form-container">
    <div>
      <label for="produk_id">Produk</label>
      <select id="produk_id" required></select>
    </div>

    <div>
      <label for="harga_modal_promo">Harga Modal Promo</label>
      <input type="number" id="harga_modal_promo" required placeholder="Masukkan harga promo">
    </div>

    <div>
      <label for="tanggal_mulai">Tanggal Mulai</label>
      <input type="date" id="tanggal_mulai">
    </div>

    <div>
      <label for="tanggal_berakhir">Tanggal Berakhir (opsional)</label>
      <input type="date" id="tanggal_berakhir">
    </div>

    <div class="promo-toggle">
      <label class="switch">
        <input type="checkbox" id="aktif" checked>
        <span class="slider"></span>
        <span class="label-text">Promo Aktif</span>
      </label>
    </div>

    <button type="submit" style="font-weight: bold;">Simpan Promo</button>
    <button onclick="window.location.href='daftar_promo.html'">Daftar Promo</button>
  </form>

  <div class="d-flex justify-content-between align-items-center mb-4 nav-bar-custom">
    <div>
      <button id="toggleSidebar" class="btn-nav">‚ò∞</button>
      <a href="javascript:history.back()" class="btn-nav">Back</a>
      <a href="../index.html" class="btn-nav">Home</a>
    </div>
      <button class="toggle-mode">üåì</button>
  </div>

  <div id="sidebar" class="sidebar hidden">
    <div class="sidebar-content">
      <button id="closeSidebar">√ó</button>
      <h2>Pengaturan</h2>
      <ul>
        <li><button onclick="alert('Buka settings')">‚öôÔ∏è Settings</button></li>
        <li><button onclick="window.location.href='promo.html'">üíØ Promo</button></li>
        <li><button onclick="location.reload()">üîÑ Update App</button></li>
        <li><button onclick="clearCache()">üóëÔ∏è Hapus Cache</button></li>
      </ul>
    </div>
  </div>

  <div id="overlay" class="overlay hidden"></div>
<script type="module" src="../sidebar.js"></script>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    const SUPABASE_URL = 'https://uagbiwhyapkrxkyyjeza.supabase.co';
    const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVhZ2Jpd2h5YXBrcnhreXlqZXphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM0NDUyNjcsImV4cCI6MjA2OTAyMTI2N30.k6dR0RL0yfElQC5wWKC2ab5npBSiLwaCecxq6j2fdWE';
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON);

    const produkSelect = document.getElementById('produk_id');
    const form = document.getElementById('promoForm');

    // üîπ Ambil daftar produk buat dropdown
    async function loadProduk() {
      let { data, error } = await supabase.from('products').select('id, nama_produk, kategori, durasi');
      if (error) { console.error(error); return; }
      produkSelect.innerHTML = data.map(p => 
        `<option value="${p.id}">${p.nama_produk} - ${p.kategori} - ${p.durasi}</option>`
      ).join('');
    }
    loadProduk();

    // üîπ Submit promo
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const { error } = await supabase.from('promo').insert([{
        produk_id: produkSelect.value,
        harga_modal_promo: document.getElementById('harga_modal_promo').value,
        tanggal_mulai: document.getElementById('tanggal_mulai').value || null,
        tanggal_berakhir: document.getElementById('tanggal_berakhir').value || null,
        aktif: document.getElementById('aktif').checked
      }]);

      if (error) {
        alert("‚ùå Gagal simpan promo: " + error.message);
      } else {
        alert("‚úÖ Promo berhasil disimpan!");
        form.reset();
        loadProduk();
      }
    });

    function toggleMode() {
    document.body.classList.toggle('dark-mode');
    const isDark = document.body.classList.contains('dark-mode');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
  }

  document.addEventListener('DOMContentLoaded', () => {
    // Setel mode dari localStorage
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
      document.body.classList.add('dark-mode');
    }

    // Event handler tombol toggle
    const toggleButton = document.querySelector('.toggle-mode');
    if (toggleButton) {
      toggleButton.addEventListener('click', toggleMode);
    }
    });
  </script>
</body>
</html>
